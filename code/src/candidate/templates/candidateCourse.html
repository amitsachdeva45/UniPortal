{% extends 'candidateLayout.html' %}

{% block content %}
    <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12 candidate-home-main">
        <div class="col-lg-6 col-xs-6 col-sm-6 col-md-6 candidate-course-home" >
            <h3 style="color:white">SELECTED COURSE</h3>
            <h4 style="color:yellow">Current GPA: {{totalScores}}</h4>
            <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12" style="border: 1px solid white;">
                <form action="" method="POST" id = "selectCandidateCourse">
                    {% csrf_token %}
                    <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                      <select name="semester" id ="semester" style="width:100%; height: 40px; color: white; background-color: #666; margin-top:10px; ">
                            {% for i in total_semester%}
                              <option value="{{i}}">Semester {{i}}</option>
                            {% endfor%}
                      </select>
                   </div>
                    <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                      <button type="submit" style="width:50%; color: white; background-color: black; border: 0px; margin-left: 20%;">Submit</button>
                   </div>
                </form>
            </div>
            <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12" id="selectedCourses" >
            </div>
        </div>
        <div class="col-lg-6 col-xs-6 col-sm-6 col-md-6 candidate-course-home">
            <h3 style="color:white">SELECT COURSE</h3>
            <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                  <select name="remaining_semester" id ="remaining_semester" style="width:100%; height: 40px; color: white; background-color: #666; margin-top:10px; ">
                      <option value="-1">--Select Semester--</option>
                      {% for i in remaining_semester%}
                         <option value="{{i}}">Semester {{i}}</option>
                      {% endfor %}
                  </select>
            </div>
            <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12" id="courseTaken">
            </div>
        </div>
    </div>
<script type="text/javascript">
    $( window ).on( "load", function() {
        submitSelectedCourse();
    });
    $(document).on('submit','#selectCandidateCourse', function(e) {
        e.preventDefault();
        submitSelectedCourse();
    });
    function getCSRFToken() {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                if (cookie.substring(0, 10) == ('csrftoken' + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(10));
                    break;
                }
            }
        }
        return cookieValue;
    }
    function selectCourse(id, user_id, semester)
    {
        $.ajax({
            type: 'POST',
            url: '/candidate/selectCourse/',
            data: {
                       "course_id" : id,
                       "user_id": user_id,
                       csrfmiddlewaretoken: getCSRFToken()
                   },
                   success: function(json) {
                        remainingSemester(semester);
                   }
             });

    }
    function remainingSemester(url)
    {
        $.ajax({
            type: 'GET',
            url: '/candidate/fetchCourseSemester/'+ url,
            data: {
                  },
                  success: function(json) {
                      var final_html = "";

                        for(var i=0; i<json.length; i++)
                        {
                            final_html += '<div class="col-lg-12 col-xs-12 col-sm-12 col-md-12" style="border:1px solid black; margin-top:10px; color:#333; background-color:#999;">';
                            final_html += '<h5><strong>Course Name: </strong>'+json[i]['name']+'</h5>';
                            final_html += '<h6><strong>Course Description: </strong>'+json[i]['description']+'</h6>';
                            final_html += '<button style="background-color: black; border:0px; color:white" onclick="selectCourse('+json[i]['id']+','+json[i]['user_id']+','+json[i]['semester'] +')">Select</button>';
                            final_html += '</div>';
                        }
                        $("#courseTaken").html(final_html);
                  }
            });
    }
    $('#remaining_semester').on('change', function (e) {
        var url = $("#remaining_semester").val();
        if(url == -1) {
            $("#courseTaken").html("");
            return;
        }
        remainingSemester(url);

    });
    function submitSelectedCourse() {
        $.ajax({
            type: 'POST',
            url: '/candidate/fetchCourse/',
            data: {
                       semester: $("#semester").val()?$("#semester").val():1,
                       csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                  },
                  success: function(json) {
                    var final_html = "";
                    final_html += '<div class="col-lg-12 col-xs-12 col-sm-12 col-md-12" style="overflow:auto; height:340px;">';
                    for(var i=0; i<json.length; i++)
                    {
                        final_html += '<div class="col-lg-12 col-xs-12 col-sm-12 col-md-12" style="border:1px solid black; margin-top:10px; color:#333; background-color:#999;">';
                        final_html += '<h5><strong>Course Name: </strong>'+json[i]['course_name']+'</h5>';
                        final_html += '<h6><strong>Course Description: </strong>'+json[i]['description']+'</h6>';
                        if(json[i]['status'] == 'complete')
                        {
                           final_html += '<h6 style="color:yellow"><strong>Scores: </strong>'+ json[i]['scores']+'</h6>';
                           final_html += '<h6 style="color:green"><strong>Status: </strong> Complete</h6>';

                        }
                        else
                        {
                            final_html += '<h6 style="color:red"><strong>Status: </strong>Pending</h6>';
                        }

                        final_html += '</div>';
                    }
                    final_html += '</div>';
                    $("#selectedCourses").html(final_html);
                  }
        });
    }
</script>
{% endblock %}